{% extends "layout.html" %}
{% block content %}

<nav class="navbar navbar-toggleable-md navbar-inverse fixed-top bg-inverse">
  <a class="navbar-brand" href="#">toco ちゃんバス あと何分？</a>
</nav>

<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-lg-12">

      <h4>循環を選択してください</h4>
      <div id="flickity">
        <ul class="js-flickity" data-flickity-options='{ "wrapAround": true, "initialIndex": {{ circuit_flickity_index }} }'>
          {% for id in circuits %}
          <li class="slide circuit" data-circuit_id="{{ circuits[id].id }}" style="background:{{ circuits[id].bgcolor }}">
            <span>{{ circuits[id].name }}循環</span>
          </li>
          {% endfor %}
        </ul>
        <p><button id="select_circuit" type="button" class="btn btn-secondary btn-lg btn-block">この循環を選択する</button></p>
      </div>

      <div id="blocks-circuit">
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <h4>停留所を選択してください</h4>

        {% for cid in circuits %}
        <div class="table-responsive block-circuit" data-circuit_id="{{ circuits[cid].id }}" {% if cid != circuit_id %}style="display:none;"{% endif %}>
          <h4>{{ circuits[cid].name }}循環</h4>
          <span class="text-danger">※{{ defaults.exclude_hours|join(',') }}時台は運行しません</span>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>停留所</th>
                <th>到着時刻</th>
                <th></th>
              </tr>
            </thead>

            <tbody>
              {% for id in time_tables[circuits[cid].id] %}
              <tr>
                <td>{{ time_tables[circuits[cid].id][id].station }}</td>
                <td>{{ time_tables[circuits[cid].id][id].arrived_at }}</td>
                <td><button type="button" class="btn btn-outline-success set_station_id" data-station_id="{{ id }}">選択</button></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% endfor %}
      </div>


      <div>&nbsp;</div>
      <div>&nbsp;</div>

      <div id="block-station" style="display:none;">
        <h3>
          {{ circuits[circuit_id].name }}循環
          <span class="station"></span>
        </h3>

        {% if next_time_tables|length == 0 %}
          <h4><span>本日のバスは終了しました。</span></h4>
        {% else %}
          <div id="flickity">
            <ul class="js-flickity">
              {% for next_arrived_at in next_time_tables %}
              <li class="slide timetable" data-time="{{ next_arrived_at }}"><span></span></li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
